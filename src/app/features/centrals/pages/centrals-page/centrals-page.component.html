<!-- Header Section -->
<div class="flex flex-row justify-between mb-6">
  <div class="font-montserrat">
    <h1 class="text-accent font-semibold text-xl">
      @if (isSelectorMode()) {
        Seleccionar Central
      } @else {
        Listado de Centrales
      }
    </h1>
    <p class="text-base-content/70 text-lg">
      @if (isSelectorMode()) {
        Elija una central de la lista
      } @else {
        Gestión completa de centrales telefónicas
      }
    </p>
  </div>

  <div class="flex gap-2">
    @if (!isSelectorMode() && authService.user()?.roles?.includes('super_user')) {
      <button type="button" class="btn btn-primary" (click)="onNewCentral()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Nueva Central
      </button>
    }

    @if (isSelectorMode()) {
      <button class="btn btn-ghost" (click)="onCloseSelector()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        Cerrar
      </button>
    }
  </div>
</div>

<!-- Search Section -->
<div class="mb-6">
  <div class="form-control">
    <div class="flex gap-4 input-group">
      <input
        type="text"
        placeholder="Buscar por nombre o código de central..."
        class="input input-bordered w-full"
        [value]="query()"
        (input)="onSearch($any($event.target).value)"
        (keyup.enter)="onSearchImmediate(query())"
      >
      @if (query()) {
        <button class="btn btn-soft" (click)="onSearchImmediate('')">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          Limpiar
        </button>
      }
    </div>
  </div>
</div>

<!-- Search Results Info -->
@if (query()) {
  <div class="alert alert-info mb-4">
    <div>
      <span>Buscando: "{{ query() }}"</span>
      @if (centralsResource.value()) {
        <span class="ml-2">- Encontradas {{ centralsResource.value()?.count || 0 }} central(es)</span>
      }
    </div>
  </div>
}

<!-- Table Section -->
<centrals-table
  [central]="centralsResource.value()?.centralLengths ?? []"
  [isSelectorMode]="isSelectorMode()"
  (editCentral)="onEditCentral($event)"
  (deleteCentral)="onDeleteCentral($event)"
  (selectCentral)="onSelectCentral($event)"
/>

<!-- Pagination Section -->
@if (centralsResource.value() && centralsResource.value()!.pages > 1) {
  <div class="mt-6 flex justify-between items-center">
    <div class="text-sm text-base-content/60">
      Página {{ paginationService.currentPage() }} de {{ centralsResource.value()?.pages || 1 }}
      - Mostrando {{ centralsResource.value()?.centralLengths?.length || 0 }} de
      {{ centralsResource.value()?.count || 0 }} centrales
      @if (query()) {
        <span class="ml-2">(Filtradas)</span>
      }
    </div>

    <div class="join">
      <button
        class="join-item btn"
        [disabled]="paginationService.currentPage() === 1"
        (click)="onPageChange(paginationService.currentPage() - 1)"
      >
        «
      </button>

      @let totalPages = centralsResource.value()?.pages || 1;
      @let currentPage = paginationService.currentPage();

      @for (page of getPageRange(totalPages, currentPage); track page) {
        <button
          class="join-item btn"
          [class.btn-active]="currentPage === page"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>
      }

      <button
        class="join-item btn"
        [disabled]="paginationService.currentPage() === totalPages"
        (click)="onPageChange(paginationService.currentPage() + 1)"
      >
        »
      </button>
    </div>
  </div>
}

<!-- Create/Edit Modal -->
@if (showModal()) {
  <div class="modal modal-open">
    <div class="modal-box max-w-4xl w-11/12 max-h-[90vh] overflow-hidden flex flex-col">
      <!-- Modal Header -->
      <div class="flex justify-between items-center mb-6 pb-4 border-b border-base-content/10">
        <h3 class="font-bold text-xl flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
          </svg>
          {{ isEdit() ? 'Editar' : 'Nueva' }} Central
        </h3>
        <button class="btn btn-ghost btn-circle btn-sm" (click)="onCancelModal()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="flex-1 overflow-y-auto pr-2">
        <central-form
          [central]="selectedCentral()"
          [isEdit]="isEdit()"
          (saved)="onSaveCentral($event)"
          (cancelled)="onCancelModal()"
        />
      </div>
    </div>

    <div class="modal-backdrop bg-black/50" (click)="onCancelModal()"></div>
  </div>
}

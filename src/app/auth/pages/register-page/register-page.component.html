<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-6 text-center">Formulario de Usuarios</h1>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="shadow-lg rounded px-8 pt-6 pb-8 mb-4">
    <!-- Primera fila - 4 columnas -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">

      <div>
        <label class="block text-sm font-bold mb-2" for="email">
          Correo corporativo
        </label>
        <input class="input input-bordered w-full" id="email" type="text" placeholder="@cantv.com.ve" name="email"
          formControlName="email" [class.border-red-500]="registerForm.get('email')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('email')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="fullName">
          Nombres
        </label>
        <input class="input input-bordered w-full" id="fullName" type="text" placeholder="Nombres completos"
          name="fullName" formControlName="fullName"
          [class.border-red-500]="registerForm.get('fullName')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('fullName')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="surnames">
          Apellidos
        </label>
        <input class="input input-bordered w-full" id="surnames" type="text" placeholder="Apellidos" name="surnames"
          formControlName="surnames" [class.border-red-500]="registerForm.get('surnames')?.errors ?? false"
          tabindex="1" />
        <form-error-label [control]="registerForm.get('surnames')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="cedula">
          Cedula
        </label>
        <input class="input input-bordered w-full" id="cedula" type="text" placeholder="N° de cedula" name="cedula"
          formControlName="cedula" [class.border-red-500]="registerForm.get('cedula')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('cedula')!" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">

      <div>
        <label class="block text-sm font-bold mb-2" for="p00">
          P00
        </label>
        <input class="input input-bordered w-full" id="p00" type="text" placeholder="Ej. 123456" name="p00"
          formControlName="p00" [class.border-red-500]="registerForm.get('p00')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('p00')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="date_birthday">
          Fecha de nacimiento
        </label>
        <input class="input input-bordered w-full" id="date_birthday" type="date" name="date_birthday"
          formControlName="date_birthday" [class.border-red-500]="registerForm.get('date_birthday')?.errors ?? false"
          tabindex="1" />
        <form-error-label [control]="registerForm.get('date_birthday')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="gender">
          Genero
        </label>
        <select formControlName="gender" class="select mb-3 py-2 w-full" id="gender" name="gender">
          <option class="" disabled selected>
            Seleccione un cargo
          </option>
          @for (gender of genders(); track gender.value) {
          <option class="capitalize rounded-sm px-2 py-1 hover:font-bold hover:italic" [value]="gender.value">
            {{ gender.text }}
          </option>
          }
        </select>
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="company_entry_date">
          Fecha ingreso CANTV
        </label>
        <input class="input input-bordered w-full" id="company_entry_date" type="date" name="company_entry_date"
          formControlName="company_entry_date"
          [class.border-red-500]="registerForm.get('company_entry_date')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('company_entry_date')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="management_entry_date">
          Fecha ingreso dpto.
        </label>
        <input class="input input-bordered w-full" id="management_entry_date" type="date" name="management_entry_date"
          formControlName="management_entry_date"
          [class.border-red-500]="registerForm.get('management_entry_date')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('management_entry_date')!" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div class="mb-6">
        <label class="block text-sm font-bold mb-2" for="full_address">
          Dirección de residencia
        </label>
        <textarea class="textarea textarea-bordered w-full" id="full_address" rows="2"
          placeholder="Dirección de residencia completa" name="full_address" formControlName="full_address"
          tabindex="9"></textarea>
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="parishId">
          Parrroquia de residencia
        </label>
        <select formControlName="parishId" class="capitalize select mb-3 py-2 w-full" id="parishId" name="parishId"
          [class.border-red-500]="registerForm.get('parishId')?.errors ?? false" tabindex="8">
          <option disabled selected>
            Seleccione un estado
          </option>
          @for (parish of parishesResource.value(); track parish.id) {
          <option [ngValue]="parish.id" class="capitalize">
            {{ parish.parish }} - {{ parish.municipality.municipality }} - {{ parish.municipality.state.state }}
          </option>
          }
        </select>
        <form-error-label [control]="registerForm.get('parishId')!" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="block text-sm font-bold mb-2" for="personalEmail">
          Correo Personal
        </label>
        <input class="input input-bordered w-full" id="personalEmail" type="personalEmail" placeholder="Correo personal"
          name="personalEmail" formControlName="personalEmail"
          [class.border-red-500]="registerForm.get('personalEmail')?.errors ?? false" tabindex="5" />
        <form-error-label [control]="registerForm.get('personalEmail')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="personalPhone">
          Teléfono celular
        </label>
        <input class="input input-bordered w-full" id="personalPhone" type="text" placeholder="0416-1234567"
          name="personalPhone" formControlName="personalPhone"
          [class.border-red-500]="registerForm.get('personalPhone')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('personalPhone')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="officePhone">
          Teléfono oficina
        </label>
        <input class="input input-bordered w-full" id="officePhone" type="text" placeholder="0212-1234567"
          name="officePhone" formControlName="officePhone"
          [class.border-red-500]="registerForm.get('officePhone')?.errors ?? false" tabindex="1" />
        <form-error-label [control]="registerForm.get('officePhone')!" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <div>
        <label class="block text-sm font-bold mb-2" for="coordinationId">
          Coordinación
        </label>
        <select formControlName="coordinationId" class="select mb-3 py-2 w-full" id="coordinationId"
          name="coordinationId" [class.border-red-500]="registerForm.get('coordinationId')?.errors ?? false"
          tabindex="8">
          <option disabled selected>
            Seleccione una coordinación
          </option>
          @for (coordination of coordinationsResource.value(); track coordination.id) {
          <option class="capitalize rounded-sm px-2 py-1 hover:font-bold hover:italic" [ngValue]="coordination.id">
            {{ coordination.coordination }}
          </option>
          }
        </select>
        <form-error-label [control]="registerForm.get('coordinationId')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="positionId">
          Cargo
        </label>
        <select formControlName="positionId" class="select mb-3 py-2 w-full" id="positionId" name="positionId"
          [class.border-red-500]="registerForm.get('positionId')?.errors ?? false" tabindex="8">
          <option disabled selected>
            Seleccione un cargo
          </option>
          @for (position of PositionsResource.value(); track $index) {
          <option class="capitalize rounded-sm px-2 py-1 hover:font-bold hover:italic" [ngValue]="position.id">
            {{ position.position }}
          </option>
          }
        </select>
        <form-error-label [control]="registerForm.get('positionId')!" />
      </div>

      <div>
        <label class="block text-sm font-bold mb-2" for="positionId">
          Niveles educativos
        </label>
        <div class="relative">
          <input type="text" class="input input-bordered w-full pr-10" [value]="displayText()" (click)="openModal()"
            [class.border-red-500]="registerForm.get('levelEducationsIds')?.errors ?? false" tabindex="1">
          <!-- <form-error-label [control]="registerForm.get('levelEducationsIds')!" /> -->
          <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3" (click)="openModal()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>
        @if (registerForm.controls.levelEducationsIds.invalid && registerForm.controls.levelEducationsIds.touched) {
        <label class="label">
          <span class="text-red-500 text-xs">Se requiere al menos un nivel educativo</span>
        </label>
        }
      </div>

      <!-- Modal -->
      @if (showModal()) {
      <dialog class="modal modal-open">
        <div class="modal-box max-w-4xl">
          <h3 class="font-bold text-lg">Seleccionar Niveles Educativos</h3>

          <div class="overflow-x-auto mt-4">
            <table class="table">
              <thead>
                <tr>
                  <th>Selección</th>
                  <th>ID</th>
                  <th>Nombre</th>
                </tr>
              </thead>
              <tbody>
                @for (level of LevelEducationsResource.value(); track level.id) {
                <tr>
                  <td>
                    <input type="checkbox" class="checkbox" [checked]="tempSelected().includes(level.id)"
                      (change)="toggleSelection(level.id)">
                  </td>
                  <td>{{ level.id }}</td>
                  <td>{{ level.levelEducation }}</td>
                </tr>
                }
              </tbody>
            </table>
          </div>

          <div class="modal-action">
            <button type="button" class="btn" (click)="showModal.set(false)">Cancelar</button>
            <button type="button" class="btn btn-primary" (click)="saveSelection()">Guardar</button>
          </div>
        </div>
      </dialog>
      }

    </div>

    <div class="flex justify-between gap-4 mt-8">
      <div class="tooltip" data-tip="La contraseña debe tener: 2 mayúsculas, 2 minúsculas, 4 números, 2 símbolos (!@#$%&*), exactamente 10 caracteres y no contener '.' o saltos de línea">
        <input class="input input-bordered w-full" id="password" type="text" placeholder="Constraseña" name="password"
          formControlName="password" [class.border-red-500]="registerForm.get('password')?.errors ?? false"
          tabindex="1" />
        <form-error-label [control]="registerForm.get('password')!" />
      </div>

      <div class="flex gap-4">
        <button type="button" (click)="onCancel()" class="btn btn-error">Cancelar</button>
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </div>

  </form>

</div>
